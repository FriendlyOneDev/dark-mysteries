import{a as S,u as z,_ as x,C as $}from"./Curtain-B30YG_C6.js";import{_ as g,c as l,o as n,F as k,e as M,j as C,a as u,t as I,g as v,k as N,v as B,d,u as p,l as E,p as j,q,s as F,b as P,w as V,n as W,h as D}from"./index-DR3wwGQv.js";const H={class:"history"},L={class:"bubble"},O={__name:"MessageHistory",props:["messages"],setup(i){return(t,s)=>(n(),l("div",H,[(n(!0),l(k,null,M(i.messages,({text:a,type:r})=>(n(),l("div",{class:C(["message",r?"question":"answer"])},[u("div",L,I(a),1)],2))),256))]))}},R=g(O,[["__scopeId","data-v-12bc33fb"]]),T={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960"};function Y(i,t){return n(),l("svg",T,t[0]||(t[0]=[u("path",{d:"M120-160v-640l760 320zm80-120 474-200-474-200v140l240 60-240 60zm0 0v-400z"},null,-1)]))}const A={render:Y},J=["disabled"],U={type:"submit",class:"btn-icon"},G={__name:"MessageInput",props:["disable"],emits:["message"],setup(i,{emit:t}){const s=v(""),a=t;function r(){s.value&&(a("message",s.value),s.value="")}return(m,o)=>(n(),l("form",{onSubmit:E(r,["prevent"]),class:"message-send"},[N(u("input",{"onUpdate:modelValue":o[0]||(o[0]=c=>s.value=c),disabled:i.disable,class:"message-input",placeholder:"type"},null,8,J),[[B,s.value]]),u("button",U,[d(p(A),{class:"icon"})])],32))}},K=g(G,[["__scopeId","data-v-23b919da"]]),Q={class:"wrapper"},X={class:"chat"},Z={__name:"Chat",setup(i){const t={bad:"I don't understand you. Try rephrasing your question",yes:"Yes",no:"No"},s=v(!0),a=v(!0),r=j([]),{status:m,socket:o}=S(e=>new WebSocket(`wss://dark-mysteries-production.up.railway.app/ws/${e.params.id}`)),{status:c,data:_}=z(e=>fetch(`/api/story/${e.params.id}`)),h=q(()=>({done:m.value.done&&c.value.done,error:m.value.error??c.value.error}));F(o,e=>{e&&e.addEventListener("message",f=>{if(s.value)return;let{answer:w,solved:y}=JSON.parse(f.data);r.push({text:y?"Congrats! You have solved it":t[w],type:!1}),a.value=!0})},{immediate:!0});function b(e){s.value=!1,a.value=!1,r.push({text:e,type:!0}),WebSocket.OPEN==o.value.readyState?o.value.send(e):h.value={done:!0,error:new Error}}return(e,f)=>(n(),P(x,W(D(h.value)),{default:V(()=>[u("div",Q,[d($,{class:"preview",puzzle:p(_).puzzle,emoji:p(_).emoji,title:p(_).title},null,8,["puzzle","emoji","title"]),u("div",X,[d(R,{messages:r},null,8,["messages"]),d(K,{disable:!a.value,onMessage:b},null,8,["disable"])])])]),_:1},16))}},te=g(Z,[["__scopeId","data-v-0a73ae19"]]);export{te as default};
