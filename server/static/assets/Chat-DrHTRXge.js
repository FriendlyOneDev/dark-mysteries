import{a as x,u as $,_ as k}from"./loader-Cm8ZGjkq.js";import{_ as h,d as u,o as c,F as M,e as z,j as I,a as t,t as _,h as p,k as N,v as B,b as m,u as v,l as C,p as E,q as j,s as q,c as F,w as P,n as V,g as W}from"./index-AGNLKjYL.js";const D={class:"history"},H={class:"bubble"},L={__name:"MessageHistory",props:["messages"],setup(i){return(a,s)=>(c(),u("div",D,[(c(!0),u(M,null,z(i.messages,({text:o,type:r})=>(c(),u("div",{class:I(["message",r?"question":"answer"])},[t("div",H,_(o),1)],2))),256))]))}},O=h(L,[["__scopeId","data-v-12bc33fb"]]),R={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960"};function T(i,a){return c(),u("svg",R,a[0]||(a[0]=[t("path",{d:"M120-160v-640l760 320zm80-120 474-200-474-200v140l240 60-240 60zm0 0v-400z"},null,-1)]))}const Y={render:T},A=["disabled"],J={type:"submit",class:"btn-icon"},U={__name:"MessageInput",props:["disable"],emits:["message"],setup(i,{emit:a}){const s=p(""),o=a;function r(){s.value&&(o("message",s.value),s.value="")}return(l,n)=>(c(),u("form",{onSubmit:C(r,["prevent"]),class:"message-send"},[N(t("input",{"onUpdate:modelValue":n[0]||(n[0]=d=>s.value=d),disabled:i.disable,class:"message-input",placeholder:"type"},null,8,A),[[B,s.value]]),t("button",J,[m(v(Y),{class:"icon"})])],32))}},G=h(U,[["__scopeId","data-v-23b919da"]]),K={class:"wrapper"},Q={class:"preview"},X={class:"emoji"},Z={class:"description"},ee={class:"chat"},se={__name:"Chat",setup(i){const a={bad:"I don't understand you. Try rephrasing your question",yes:"Yes",no:"No"},s=p(!0),o=p(!0),r=E([]),{status:l,socket:n}=x(e=>new WebSocket(`wss://dark-mysteries.onrender.com/ws/${e.params.id}`)),{status:d,data:g}=$(e=>fetch(`/api/story/${e.params.id}`)),f=j(()=>({done:l.value.done&&d.value.done,error:l.value.error??d.value.error}));q(n,e=>{e&&e.addEventListener("message",b=>{if(s.value)return;let{answer:y,solved:S}=JSON.parse(b.data);r.push({text:S?"Congrats! You have solved it":a[y],type:!1}),o.value=!0})},{immediate:!0});function w(e){s.value=!1,o.value=!1,r.push({text:e,type:!0}),WebSocket.OPEN==n.value.readyState?n.value.send(e):f.value={done:!0,error:new Error}}return(e,b)=>(c(),F(k,V(W(f.value)),{default:P(()=>[t("div",K,[t("div",Q,[t("span",X,_(v(g).emoji),1),t("div",Z,_(v(g).puzzle),1)]),t("div",ee,[m(O,{messages:r},null,8,["messages"]),m(G,{disable:!o.value,onMessage:w},null,8,["disable"])])])]),_:1},16))}},oe=h(se,[["__scopeId","data-v-05d515ab"]]);export{oe as default};
